
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>SuperMDA_database2CellProfilerCSV</title><meta name="generator" content="MATLAB 8.3"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2014-09-09"><meta name="DC.source" content="SuperMDA_database2CellProfilerCSV.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>SuperMDA_database2CellProfilerCSV</h1><!--introduction--><p>A database text-file is created after using SuperMDA. If the images will be analyzed using cellprofiler.org software it is useful to have a cellprofiler.org-ready CSV file created. This function will create such a file.</p><pre class="language-matlab">[] =
SuperMDA_database2CellProfilerCSV(path2database,path2imagefiles,outputpath)
</pre><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Input</a></li><li><a href="#2">Output:</a></li><li><a href="#3">Detailed Description</a></li><li><a href="#4">Other Notes</a></li><li><a href="#5">Import the SuperMDA database file</a></li><li><a href="#6">Look into the database and find the channels</a></li><li><a href="#7">Check: each channel should have the same number of files</a></li><li><a href="#9">Create a table variable to hold the CSV file data</a></li></ul></div><h2>Input<a name="1"></a></h2><div><ul><li>path2database: a string. The path to the SuperMDA database file.</li><li>path2imagefiles: a string. The path to the directory containing the image files.</li><li>outputpath: a string. The path to the directory where the CSV file will be saved.</li></ul></div><h2>Output:<a name="2"></a></h2><p>There is no direct argument output. Rather, a CSV file that is compatible with cellprofiler.org is created and saved in the outputpath directory.</p><h2>Detailed Description<a name="3"></a></h2><p>There is no detailed description.</p><h2>Other Notes<a name="4"></a></h2><p>There are no other notes</p><pre class="codeinput"><span class="keyword">function</span> [] = SuperMDA_database2CellProfilerCSV(path2database,path2imagefiles,outputpath)
</pre><h2>Import the SuperMDA database file<a name="5"></a></h2><pre class="codeinput">myDatabase = readtable(path2database,<span class="string">'Delimiter'</span>,<span class="string">'\t'</span>);
</pre><h2>Look into the database and find the channels<a name="6"></a></h2><pre class="codeinput">channelNumberColumn = myDatabase.channel_number;
channelNumberUnique = unique(channelNumberColumn);
channelNames = cell(size(channelNumberUnique));
<span class="keyword">for</span> i = 1:length(channelNames) <span class="comment">%floop 1</span>
    floop1ChannelNumber = channelNumberUnique(i);
    floop1ChannelInd = find(channelNumberColumn == floop1ChannelNumber,1,<span class="string">'first'</span>);
    channelNames(i) = myDatabase.channel_name(floop1ChannelInd);
<span class="keyword">end</span>
</pre><h2>Check: each channel should have the same number of files<a name="7"></a></h2><p>cellprofiler.org expects each channel to have the same number of images. Since this is not a requirement in SuperMDA a test is made.</p><pre class="codeinput">numberOfImagesInEachChannel = zeros(size(channelNumberUnique));
<span class="keyword">for</span> i = 1:length(channelNumberUnique) <span class="comment">%floop 2</span>
    numberOfImagesInEachChannel(i) = sum(channelNumberColumn == channelNumberUnique(i));
<span class="keyword">end</span>
</pre><p>The database will be reduced such that each channel will have corresponding images for the channel with the fewest images. This reduction will only take into account differences in image frequency and does not account for differences in tiling or z-stack; if these latter differences occur and error will not be thrown and a corrupt CSV file will be created.</p><pre class="codeinput"><span class="keyword">if</span> ~all(numberOfImagesInEachChannel == numberOfImagesInEachChannel(1)) <span class="comment">%if 1</span>
    [~,if1min] = min(numberOfImagesInEachChannel);
    if1MinLogical = strcmp(myDatabase.channel_name,channelNames{if1min});
    if1FinalLogical = ismember(myDatabase.timepoint,myDatabase.timepoint(if1MinLogical));
    myDatabase = myDatabase(if1FinalLogical,:);
<span class="keyword">end</span>
</pre><h2>Create a table variable to hold the CSV file data<a name="9"></a></h2><p>The table will have two columns for each channel_name</p><pre class="codeinput">cellprofilerCSVheader = cell(1,2*length(channelNumberUnique));
cellprofilerdata = cell(1,2*length(channelNumberUnique));
</pre><p>cellprofiler.org wants a column of filenames and a column of paths for each channel.</p><pre class="codeinput"><span class="keyword">for</span> i = 1:length(channelNumberUnique) <span class="comment">%floop 3</span>
    cellprofilerCSVheader{2*i-1} = sprintf(<span class="string">'Image_FileName_%s'</span>,channelNames{i});
    cellprofilerCSVheader{2*i} = sprintf(<span class="string">'Image_PathName_%s'</span>,channelNames{i});
    floop3logical = strcmp(myDatabase.channel_name,channelNames{i});
    cellprofilerdata{2*i-1} = myDatabase.filename(floop3logical);
    cellprofilerdata{2*i} = repmat(path2imagefiles,[numberOfImagesInEachChannel(1),1]);
<span class="keyword">end</span>
cellprofilerCSVTable = table(cellprofilerdata{:},<span class="string">'VariableNames'</span>,cellprofilerCSVheader);
writetable(cellprofilerCSVTable,fullfile(outputpath,<span class="string">'cellprofilerCSV.csv'</span>),<span class="string">'Delimiter'</span>,<span class="string">','</span>);
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2014a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% SuperMDA_database2CellProfilerCSV
% A database text-file is created after using SuperMDA. If the images will
% be analyzed using cellprofiler.org software it is useful to have a
% cellprofiler.org-ready CSV file created. This function will create such a
% file.
%
%   [] =
%   SuperMDA_database2CellProfilerCSV(path2database,path2imagefiles,outputpath)
%
%%% Input
% * path2database: a string. The path to the SuperMDA database file.
% * path2imagefiles: a string. The path to the directory containing the
% image files.
% * outputpath: a string. The path to the directory where the CSV file will
% be saved.
%
%%% Output:
% There is no direct argument output. Rather, a CSV file that is compatible
% with cellprofiler.org is created and saved in the outputpath directory.
%
%%% Detailed Description
% There is no detailed description.
%
%%% Other Notes
% There are no other notes
function [] = SuperMDA_database2CellProfilerCSV(path2database,path2imagefiles,outputpath)
%% Import the SuperMDA database file
%
myDatabase = readtable(path2database,'Delimiter','\t');
%% Look into the database and find the channels
%
channelNumberColumn = myDatabase.channel_number;
channelNumberUnique = unique(channelNumberColumn);
channelNames = cell(size(channelNumberUnique));
for i = 1:length(channelNames) %floop 1
    floop1ChannelNumber = channelNumberUnique(i);
    floop1ChannelInd = find(channelNumberColumn == floop1ChannelNumber,1,'first');
    channelNames(i) = myDatabase.channel_name(floop1ChannelInd);
end
%% Check: each channel should have the same number of files
% cellprofiler.org expects each channel to have the same number of images.
% Since this is not a requirement in SuperMDA a test is made.
numberOfImagesInEachChannel = zeros(size(channelNumberUnique));
for i = 1:length(channelNumberUnique) %floop 2
    numberOfImagesInEachChannel(i) = sum(channelNumberColumn == channelNumberUnique(i));
end
%%
% The database will be reduced such that each channel will have
% corresponding images for the channel with the fewest images. This
% reduction will only take into account differences in image frequency and
% does not account for differences in tiling or z-stack; if these latter
% differences occur and error will not be thrown and a corrupt CSV file
% will be created.
if ~all(numberOfImagesInEachChannel == numberOfImagesInEachChannel(1)) %if 1
    [~,if1min] = min(numberOfImagesInEachChannel);
    if1MinLogical = strcmp(myDatabase.channel_name,channelNames{if1min});
    if1FinalLogical = ismember(myDatabase.timepoint,myDatabase.timepoint(if1MinLogical));
    myDatabase = myDatabase(if1FinalLogical,:);
end
%% Create a table variable to hold the CSV file data
% The table will have two columns for each channel_name
cellprofilerCSVheader = cell(1,2*length(channelNumberUnique));
cellprofilerdata = cell(1,2*length(channelNumberUnique));
%%
% cellprofiler.org wants a column of filenames and a column of paths for
% each channel.
for i = 1:length(channelNumberUnique) %floop 3
    cellprofilerCSVheader{2*i-1} = sprintf('Image_FileName_%s',channelNames{i});
    cellprofilerCSVheader{2*i} = sprintf('Image_PathName_%s',channelNames{i});
    floop3logical = strcmp(myDatabase.channel_name,channelNames{i});
    cellprofilerdata{2*i-1} = myDatabase.filename(floop3logical);
    cellprofilerdata{2*i} = repmat(path2imagefiles,[numberOfImagesInEachChannel(1),1]);
end
cellprofilerCSVTable = table(cellprofilerdata{:},'VariableNames',cellprofilerCSVheader);
writetable(cellprofilerCSVTable,fullfile(outputpath,'cellprofilerCSV.csv'),'Delimiter',',');
##### SOURCE END #####
--></body></html>